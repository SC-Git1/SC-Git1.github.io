<!DOCTYPE html> 
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title> Module 2 | Slurm jobs</title>
      <meta name="author" content="Sophie Colette">
      <meta name="description" content="Module 2: Introduction to Slurm jobs">
      <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website">
      <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04">
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous">
      <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css">
      <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5">
      <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">
      <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light">
      <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;">
      <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e">
      <link rel="canonical" href="https://sc-git1.github.io/blog/2021/distill/">
      <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark">
      <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> 
      <style> p{text-align: justify;margin-bottom: 0;}</style>
      <style type="text/css">.fake-img{background:#bbb;border:1px solid rgba(0,0,0,0.1);box-shadow:0 0 4px rgba(0,0,0,0.1);margin-bottom:12px}.fake-img p{font-family:monospace;color:white;text-align:left;margin:12px 0;text-align:center;font-size:16px}</style>
   </head>
   <body>
      <header>
         <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
            <div class="container">
               <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Workshop </span>SNP Calling on the VSC</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> 
               <div class="collapse navbar-collapse text-right" id="navbarNav">
                  <ul class="navbar-nav ml-auto flex-nowrap">
                     <li class="nav-item "> <a class="nav-link" href="/">about</a> </li>
                     <li class="nav-item "> <a class="nav-link" href="/workshop/">workshop</a> </li>
                     <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li>
                  </ul>
               </div>
            </div>
         </nav>
         <progress id="progress" value="0">
            <div class="progress-container"> <span class="progress-bar"></span> </div>
         </progress>
      </header>
      <div class="post distill">
         <d-title>
            <h1>Module 2: Slurm jobs</h1>
            <p>Introduction to Slurm jobs.</p>
         </d-title>
         <d-article>
            <d-contents>
               <nav class="l-text figcaption">
                  <h3>Contents</h3>
                  <div><a href="#HPC architecture: compute nodes">HPC architecture: compute nodes</a></div>
                  <div><a href="#What is Slurm?">What is Slurm?</a></div>
                  <div><a href="#Request a batch job">Request a batch job</a></div>
                  <div><a href="#Submitting job scripts">Submitting job scripts</a></div>
                  <div><a href="#Exercises">Exercises</a></div>
               </nav>
            </d-contents>
            <h2 id="HPC architecture: compute nodes">2.1 HPC architecture: compute nodes</h2>
            <p>The Flemish Supercomputer Centrum (VSC) offers a High Performance Computer (HPC) infrastructure for scientific and technical computing. To run jobs on the VSC, it is necessary to familiarize yourself with some terms related to HPCs, particularly about compute nodes. 
               An overview is given in the figure below.</p>
               <figure>
                  <picture>
                     <source class="responsive-img-srcset" srcset=" //assets/img/HPC_overview-480.webp 480w, /assets/img/HPC_overview-800.webp 800w, /assets/img/HPC_overview-1400.webp 1400w, " sizes="95vw" type="image/webp">
                     </source> <img src="/assets/img/HPC_overview.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> 
                  </picture>
               </figure>
            <h2 id="What is Slurm?">2.2 What is Slurm?</h2>
            <p>Slurm is a (cluster) workload manager and stands for <em>Simple Unix Utility for Resource Management</em>.
               As a workload manager, it organizes the allocation of resources like computing power, memory and time to users, and manages the queue of resource requests (= jobs). To request resources on the VSC, you should submit a job.
               A job is a description of requested resources optionally along with the instructions to run when the resources are allocated. A job that only describes the resources is an interactive job.
               Once the resources are allocated, you can directly communicate with the node(s). This is useful for debugging purposes. However, it requires the user to be present when the interactive session starts.
               Also, it makes the node(s) wait for user input, which is an inefficient use of resources. An alternative is to submit a non-interactive job, called a batch job.
               An advantage of a batch job compared to an interactive job, is that the execution start once the resources are allocated, and thus it does not require the user to be present when the job starts.
               The next section explains the layout of a job request.
            </p>

            <h2 id="Request a batch job">2.3 Request a batch job</h2>
            <p>Batch jobs are submitted using the command <code class="language-plaintext highlighter-rouge">sbatch</code>. The required resources (number of nodes, walltime, memory etc.) can be
            specified by adding arguments to the command or by creating a .slurm job script that contains so called <code class="language-plaintext highlighter-rouge">#SBATCH</code> lines). In this workshop, we will add the specifications to the job script.
            <details><summary>Have a look at the manual page of sbatch</summary>
               <p>               
                  You can access the manual page by running <code class="language-shell highlighter-rouge"><span class="nf">sbatch --help</span></code>.
               </p>
               The manual page is extensive, the most important options to get you started are explained in the next paragraphs.
            </details>
            
            The next paragraphs provide information on various aspects to take into account when requesting resources.
            </p>
            <h3 id="Partition">2.3.1 Partition</h3>
            <p>A cluster can be divided into different 'partitions' based on the quality or trait of the nodes.
               Examples of partitions on the wICE hardware of the VSC (KU Leuven) are: "batch", "batch-long", "gpu", "interactive", "bigmem".
               Batch jobs that with requested time > 3 days, should be submitted to the "batch-long" partition. Next, GPU is a computing resource like CPU and stands for <em>Graphics Processing Unit</em>. It is a specialized processor that is ideal for tasks requiring intensive computations that can be run in parallel. 
               GPU can considerably speed up the task. To determine if the software you are using is optimized for GPU, you should consult the software's documentation. Additionally, some software allows you to choose between CPU and GPU processing.
               Note that running jobs on the GPU nodes is more costly, so it is important to check if the software you use is able to take advantage of the parallel processing capabilities of a GPU.
               Finally, the "bigmem" partition consists of big memroy nodes, with 2048GB of RAM. The partition is specified with the option <em>partition</em>.
            </p>
            <h3 id="Wall time">2.3.2 Wall time</h3>
            <p>Wall time is the compute time. The requested wall time can be written in the following formats: 
            mm (minutes), mm:ss (minutes and seconds), hh:mm:ss (hours, minutes and seconds), d-hh (days and hours), d-hh:mm (days, hours and minutes) or d-hh:mm:ss (days, hours, minutes and seconds).
            Wall time is an estimate of the user, based on for example the runtime of a data subset during the debugging phase. It is recommended to slightly overestimate the time needed to prevent loss of temporary results stored in the node if a job exceeds its allotted time. 
            However, avoid excessive overestimation as jobs with longer wall times are less likely to get squeezed in by the workload manager.
            To set the wall time, use the option <em>--time</em> or <em>-t</em>.
            <div class="language-plaintext highlighter-rouge">
               <div class="highlight">
                  <pre class="highlight"><code><span>#SBATCH --time=d-hh:mm:ss</span></code></pre>
               </div>
            </div>
            </p>
            <h3 id="Memory">2.3.3 Memory</h3>
            <p>Memory refers to the amount of RAM. You can specify the amount with <code class="language-plaintext highlighter-rouge">--mem-per-cpu=[amount][unit]</code>
            Again, the memory is an user-defined estimate of the amount of memory needed. It is advised to ask for a slight overestimated amount of RAM. However, make sure not exceed the maximum (see: 
            <a href="https://docs.vscentrum.be/leuven/tier2_hardware/wice_hardware.html#hardware-details" target="_blank">https://docs.vscentrum.be/leuven/tier2_hardware/wice_hardware.html#hardware-details</a>
            Memory is quantized in kilobytes (k), megabytes (m) or gigabytes (g). Examples are: 
            </p>
            <div class="language-plaintext highlighter-rouge">
               <div class="highlight">
                  <pre class="highlight"><span>#SBATCH --mem-per-cpu=100000k</span>    
<span>#SBATCH --mem-per-cpu=3300m</span>
<span>#SBATCH --mem-per-cpu=1g</span></code></pre>
               </div>
            </div>
            
            <h3 id="Job name">2.3.4 Job name</h3>
            <p>By default, the job name is the name of the job script. Alternatively, you can give your job a name using the option <em>--job-name</em>.
            </p>
            <div class="language-plaintext highlighter-rouge">
               <div class="highlight">
                  <pre class="highlight"><code><span>#SBATCH --job-name=example</span></code></pre>
               </div>
            </div>
            <h3 id="Redirecting stdout, stderr">2.3.5 Redirecting stdout, stderr</h3>
            <p>"stdout" stands for standard output. It is the location where the program writes its output data. When you run a program in the terminal, the stdout is the terminal screen.
               For batch jobs, the stdout is a file named slurm-<jobid>.out.
               Similarly, "stderr" stands for standard error and it is the location used to write errors, warnings, and informative messages.
               By default, stderr is the same file as stdout. This is similar to the behavior in the terminal.
               To change this behavior, you can specify stderr with the option <em>--error</em> or <em>(-e)</em>:
               <div class="language-plaintext highlighter-rouge">
                  <div class="highlight">
                     <pre class="highlight"><code><span>#SBATCH --error=[filename]</span></code></pre>
                  </div>
               </div>
               and to specify stdout, use the option <em>--output</em> or <em>-o</em>:
               <div class="language-plaintext highlighter-rouge">
                  <div class="highlight">
                     <pre class="highlight"><code><span>#SBATCH --output=[filename]</span></code></pre>
                  </div>
               </div>
            </p>
            <h3 id="Mail">2.3.6 Mail</h3>
            <p>Finally, when submitting a job script, you can request to receive an email about the status of your job. To do so, 
               add your email address with the option <em>--mail-user</em> and the situations in which you like to receive an email with the option <em>--email-type</em>.
               the valid values for type are: BEGIN, END, FAIL or ALL.
               <div class="language-plaintext highlighter-rouge">
                  <div class="highlight">
                     <pre class="highlight"><code><span>#SBATCH --mail-type=ALL --mail-user name@example.com</span></code></pre>
                  </div>
               </div>
            </p>
            <h2 id="Submitting job scripts">2.4 Submitting job scripts</h2>
            A slurm batch job script has the following layout:
            <ol>
               <li>#!/usr/bin/bash</li>
               <li><code class="language-plaintext highlighter-rouge">#SBATCH</code> lines</li>
               <li>Commands</li>
             </ol>
             To submit the job script, use the command:
             <div class="language-plaintext highlighter-rouge">
               <div class="highlight">
                  <pre class="highlight"><code><span>sbatch /path/to/file.slurm</span></code></pre>
               </div>
            </div>
             <p>When the job is succesfully submitted, sbatch prints a message containing the unique job id to the terminal.</p>
             <h2 id="Exercises">2.5 Exercises</h2>
               <p>
               <strong>Exercise 1</strong><br>
               Create a script that writes "Hello world" to stdout. Stdout is a file named "greeting.out", stderr is a file named "greetings.err". 
               Run the script on 1 CPU with 3400 megabytes of memory and a runtime of 2 minutes.
               
               Questions:
               <ul>
                  <li>What is the jobid?</li>
               </ul>
               
               You can find a list of your active jobs by running: 
                  <div class="language-plaintext highlighter-rouge">
                     <div class="highlight">
                        <pre class="highlight"><code><span>squeue</span></code></pre>
                     </div>
                  </div>
               </p>
               <strong>Exercise 2: synthesis</strong><br>
               <p>
                  Create a new conda environment called "ex2". Activate the environment and install the tool seqkit in the Conda environment.
                  View simple statistics with seqkit for the the "1_control_psbA3_2019_minq7.fastq" file available in the VSC folder.
                  (Alternatively, get the "1_control_psbA3_2019_minq7.fastq" file from <a href="https://zenodo.org/records/3736457" target="_blank">https://zenodo.org/records/3736457</a> [1] and upload it to the VSC)
                  to find the right command, you can have a look at the manual page using [command] [optionally: subcommand] --help.
                  Next, write a slurm script that activates the conda environment, executes the command, and writes the statistics to a file named ex2_stats.txt. 
               </p>
               <h2>You have completed Module 2!</h2>
            <h3>Next module:</h3>
            <li> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/workshop/3_SNP_Calling_from_fastq_to_vcf/">Module 3: SNP calling - part 1</a> </li>
         </d-article>
         <d-appendix>
            <d-citation-list></d-citation-list>
         </d-appendix>
         <d-bibliography src="/assets/bibliography/2018-12-22-distill.bib"></d-bibliography>
      </div>
      <footer class="fixed-bottom">
         <div class="container mt-0"> © Copyright 2023 Sophie Colette. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div>
      </footer>
      <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> 
   </body>
</html>